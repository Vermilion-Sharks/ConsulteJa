generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model apis {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  api_key          String     @unique @db.VarChar(255)
  ativa            Boolean    @default(true)
  usuario_id       String     @db.Uuid
  data_criacao     DateTime   @default(now()) @db.Timestamptz(6)
  data_atualizacao DateTime   @updatedAt @db.Timestamptz(6)
  usuarios         usuarios   @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  produtos         produtos[]

  @@index([usuario_id])
}

model produtos {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  codigo           String   @db.VarChar(13)
  nome             String   @db.VarChar(100)
  marca            String   @db.VarChar(70)
  descricao        String   @db.VarChar(300)
  preco            Decimal  @db.Decimal(10, 2)
  imagem           String?  @db.VarChar(255)
  importado        Boolean  @default(false)
  api_id           String   @db.Uuid
  data_criacao     DateTime @default(now()) @db.Timestamptz(6)
  data_atualizacao DateTime @updatedAt @db.Timestamptz(6)
  apis             apis     @relation(fields: [api_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([api_id, codigo])
  @@index([api_id])
}

model usuarios {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome           String           @db.VarChar(100)
  email          String           @unique @db.VarChar(254)
  senha          String           @db.VarChar(255)
  token_version  Int              @default(1)
  data_criacao   DateTime         @default(now()) @db.Timestamptz(6)
  apis           apis[]
  refresh_tokens refresh_tokens[]

  @@index([email])
}

model refresh_tokens {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  usuario_id       String   @db.Uuid
  token            String   @unique(map: "token_unico") @db.VarChar(64)
  session_id       String   @unique @db.Uuid
  lembre_me        Boolean  @default(false)
  dispositivo_nome String   @db.VarChar(100)
  dispositivo_hash String   @db.VarChar(64)
  data_criacao     DateTime @default(now()) @db.Timestamp(6)
  expira_em        DateTime @db.Timestamp(6)
  usuarios         usuarios @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([session_id, usuario_id, expira_em])
}
